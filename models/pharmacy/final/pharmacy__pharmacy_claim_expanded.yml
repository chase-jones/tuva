version: 2
models:
- name: pharmacy__pharmacy_claim_expanded
  config:
    schema: |
      {%- if var('tuva_schema_prefix', None) != None -%}
        {{var('tuva_schema_prefix')}}_pharmacy
      {% else %}
        pharmacy
      {%- endif -%}
    alias: pharmacy_claim_expanded
    tags:
    - pharmacy
    materialized: table
  description: >
    Expanded view of pharmacy claims with additional details.
  tests:
  - dbt_utils.unique_combination_of_columns:
  - name: test
    description: test      combination_of_columns:
  - name: test
    description: test      - data_source
      - claim_id
      - claim_line_number
  columns:
  - name: test
    description: test  - name: data_source
    description: Source of the data.
  - name: claim_id
    description: Unique identifier for each pharmacy claim.
  - name: claim_line_number
    description: Line number of the claim.
  - name: patient_id
    description: Unique identifier for each patient.
  - name: member_id
    description: Unique identifier for each member.
  - name: prescribing_provider_id
    description: ''
  - name: dispensing_provider_id
    description: ''
  - name: dispensing_date
    description: Date when the drug was dispensed.
  - name: ndc_code
    description: National Drug Code.
  - name: ndc_description
    description: Description of the drug.
  - name: quantity
    description: Quantity of the drug dispensed.
  - name: days_supply
    description: Number of days the drug supply will last.
  - name: refills
    description: Number of refills for the drug.
  - name: paid_date
    description: Date when the drug was paid for.
  - name: paid_amount
    description: Amount paid for the drug.
  - name: allowed_amount
    description: Total allowed amount covered by insurance.
  - name: rxcui
    description: RxNorm Concept Unique Identifier.
  - name: product_name
    description: Name of the product.
  - name: product_tty
    description: Term type of the product.
  - name: brand_vs_generic
    description: Indicates whether the drug is a brand or generic.
  - name: brand_name
    description: Name of the brand.
  - name: generic_rxcui
    description: RxNorm Concept Unique Identifier for the generic version.
  - name: generic_rxcui_description
    description: Description of the generic drug.
  - name: generic_tty
    description: Term type of the generic drug.
  - name: ingredient_name
    description: Active ingredient in the drug.
  - name: dose_form_name
    description: Form of the drug dose.
  - name: generic_available
    description: Indicates if a generic version is available.
  - name: brand_cost_per_unit
    description: Cost per unit for the brand drug.
  - name: generic_average_cost_per_unit
    description: Average cost per unit of the generic drug.
  - name: brand_less_generic_cost_per_unit
    description: Difference in cost per unit between the brand and generic drug.
  - name: generic_available_total_opportunity
    description: Total potential savings from substituting with generics, where applicable,
      calculated per unit.
  - name: generic_available_sk
    description: Surrogate key for generic availability data.
