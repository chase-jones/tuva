version: 2
models:
- name: pharmacy__generic_available_list
  config:
    schema: |
      {%- if var('tuva_schema_prefix', None) != None -%}
        {{var('tuva_schema_prefix')}}_pharmacy
      {% else %}
        pharmacy
      {%- endif -%}
    alias: generic_available_list
    tags:
    - pharmacy
    materialized: table
  description: >
    Provides a list of pharmacy claims where a generic alternative is available, detailing
    both brand and potential generic drug costs and descriptions.
  tests:
  - dbt_utils.unique_combination_of_columns:
  - name: test
    description: test      combination_of_columns:
  - name: test
    description: test      - generic_available_sk
      - generic_ndc
  columns:
  - name: test
    description: test  - name: generic_available_sk
    description: Surrogate key for generic availability.
  - name: data_source
    description: Source of the data.
  - name: brand_ndc_code
    description: National Drug Code for the brand drug.
  - name: brand_ndc_description
    description: Description of the brand drug.
  - name: brand_rxcui
    description: RxNorm Concept Unique Identifier for the brand drug.
  - name: brand_paid_amount
    description: Total amount paid for the brand drug.
  - name: brand_units
    description: Units of the brand drug dispensed.
  - name: brand_paid_per_unit
    description: Paid amount per unit for the brand drug, calculated as total paid
      divided by units, if units are not zero.
  - name: generic_ndc
    description: National Drug Code for the generic drug.
  - name: generic_ndc_description
    description: FDA description of the generic drug.
  - name: generic_prescribed_history
    description: Indicates if a generic version has previously been prescribed, 1
      for yes and 0 for no.
  - name: generic_cost_per_unit
    description: Cost per unit for the generic drug.
  - name: generic_cost_at_units
    description: Cost for the generic drug at the dispensed units of the brand drug.
  - name: tuva_last_run
    description: >
      The last time the data was refreshed.  Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run`  environment.  Timezone is configurable via
      the `tuva_last_run` var.


