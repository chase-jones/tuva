version: 2
models:
- name: chronic_conditions__cms_chronic_conditions_long
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_chronic_conditions
      {% else %}chronic_conditions{%- endif -%}
    alias: cms_chronic_conditions_long
    tags:
    - cms_chronic_conditions
    - chronic_conditions
    materialized: table
  description: >
    This model unions condition flags from the 3 upstream stage models that
    calculate them.
  tests:
  - dbt_utils.unique_combination_of_columns:
  - name: test
    description: test      combination_of_columns:
  - name: test
    description: test      - patient_id
      - claim_id
      - start_date
      - condition

  columns:
  - name: test
    description: test  - name: patient_id
    description: Unique ID for the patient.
    tests:
    - not_null
  - name: claim_id
    description: Unique identifier for each claim.
    tests:
    - not_null
  - name: start_date
    description: >
      Start date of the chronic condition derived from diagnosis,  procedure, or medication.
  - name: chronic_condition_type
    description: >
      The type of chronic condition as defined by CMS.  ('Common' or 'Other chronic
      or potentially disabling conditions')
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/chronic_conditions/chronic_conditions__cms_chronic_conditions_hierarchy.csv
  - name: condition_category
    description: >
      The category of the condition (e.g. Cardiovascular Disease).
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/chronic_conditions/chronic_conditions__cms_chronic_conditions_hierarchy.csv
  - name: condition
    description: The name of the chronic condition.
    tests:
    - not_null
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/chronic_conditions/chronic_conditions__cms_chronic_conditions_hierarchy.csv
  - name: data_source
    description: >
      Indicates the name of the source dataset (e.g. Medicare Claims).
  - name: tuva_last_run
    description: The time at with the model was materialized. Generated by `dbt_utils.pretty_time`
      as the local time of the `dbt run` environment.  Timezone is configurable via
      the `tuva_last_run` var.

## Intermediate
