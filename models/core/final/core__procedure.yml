version: 2
models:
- name: core__procedure
  description: >
    The procedure table contains information on procedures that were performed  on
    patients in the dataset.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
      {% else %}core{%- endif -%}
    alias: procedure
    tags: core
    materialized: table
  columns:
  - name: procedure_id
    description: The unique identifier for the performed procedure.
    tests:
    - unique:
        config:
          severity: warn
  - name: encounter_id
    description: >
      The encounter_id for the encounter where this procedure was performed.
  - name: claim_id
    description: The claim on which the procedure was recorded.
  - name: patient_id
    description: Unique identifier for each person across all datasets.
  - name: procedure_date
    description: Date when the procedure was performed.
  - name: source_code_type
    description: >
      Type of procedure code for the procedure in the source system.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: source_code
    description: The procedure code in the source system.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_pcs.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: source_description
    description: Description of the procedure code.
  - name: normalized_code_type
    description: Normalized type of procedure code for the procedure.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: normalized_code
    description: The normalized procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_pcs.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: normalized_description
    description: Description of the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: modifier_1
    description: First modifier for the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: modifier_2
    description: Second modifier for the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: modifier_3
    description: Third modifier for the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: modifier_4
    description: Fourth modifier for the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: modifier_5
    description: Fifth modifier for the procedure code.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
  - name: practitioner_id
    description: ID of the provider who performed the procedure.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: data_source
    description: >
      User-configured field that indicates the data source (e.g. typically  named
      after the payer and state "BCBS Tennessee").
  - name: tuva_last_run
    description: >
      The last time the data was refreshed.  Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run`  environment.  Timezone is configurable via
      the `tuva_last_run` var.

## Staging - Claims
