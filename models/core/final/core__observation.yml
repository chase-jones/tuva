version: 2
models:
- name: core__observation
  description: >
    The observation table contains information on measurements other than  lab tests
    e.g. blood pressure, height, and weight.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
      {% else %}core{%- endif -%}
    alias: observation
    tags: core
    materialized: table
  columns:
  - name: observation_id
    description: Unique identifier for each observation in the dataset.
    tests:
    - unique:
        config:
          severity: warn
  - name: patient_id
    description: Unique identifier for each patient in the dataset.
  - name: encounter_id
    description: Unique identifier for each encounter in the dataset.
  - name: panel_id
    description: Unique identifier for the panel.
  - name: observation_date
    description: Date the observation was recorded.
  - name: observation_type
    description: Type of observation.
  - name: source_code_type
    description: Source code type of the observation.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: source_code
    description: Source code of the observation.
  - name: source_description
    description: Source description of the observation.
  - name: normalized_code_type
    description: Normalized code type of the observation.
  - name: normalized_code
    description: Normalized code of the observation.
  - name: normalized_description
    description: Normalized description of the observation.
  - name: mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: result
    description: The result of the observation.
  - name: source_units
    description: Source units of the lab test.
  - name: normalized_units
    description: Normalized units of the lab test.
  - name: source_reference_range_low
    description: The low end of the reference range from the source system.
  - name: source_reference_range_high
    description: The high end of the reference range from the source system.
  - name: normalized_reference_range_low
    description: The normalized low end of the reference range.
  - name: normalized_reference_range_high
    description: The normalized high end of the reference range.
  - name: data_source
    description: Custom description of the source system e.g. Epic.
  - name: tuva_last_run
    description: >
      The last time the data was refreshed.  Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run`  environment.  Timezone is configurable via
      the `tuva_last_run` var.

