version: 2
models:
- name: core__medication
  description: >
    The medication table contains information on medications ordered and/or  administered
    during a patient encounter.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
      {% else %}core{%- endif -%}
    alias: medication
    tags: core
    materialized: table
  columns:
  - name: medication_id
    description: Unique identifier for each medication in the table.
    tests:
    - unique:
        config:
          severity: warn
  - name: patient_id
    description: Unique identifier for each patient in the dataset.
  - name: encounter_id
    description: Unique identifier for each encounter in the dataset.
  - name: dispensing_date
    description: Date the medication was dispensed.
  - name: prescribing_date
    description: Date the medication was prescribed.
  - name: source_code_type
    description: The source code type of the medication.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: source_code
    description: The source code for the medication.
    meta:
      terminology: https://www.nlm.nih.gov/research/umls/rxnorm/index.html
  - name: source_description
    description: The source description of the medication.
  - name: ndc_code
    description: National drug code associated with the medication.
    meta:
      terminology: 
        https://www.fda.gov/drugs/drug-approvals-and-databases/national-drug-code-directory
  - name: ndc_description
    description: Description for the NDC.
  - name: ndc_mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: rxnorm_code
    description: RxNorm code associated with the medication.
    meta:
      terminology: https://www.nlm.nih.gov/research/umls/rxnorm/index.html
  - name: rxnorm_description
    description: Description for the RxNorm code.
  - name: rxnorm_mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: atc_code
    description: ATC code for the medication.
    meta:
      terminology: https://www.who.int/tools/atc-ddd-toolkit/atc-classification
  - name: atc_description
    description: Description for the ATC code.
  - name: atc_mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: route
    description: The route used to administer the medication.
  - name: strength
    description: The strength of the medication.
  - name: quantity
    description: The quantity of the medication.
  - name: quantity_unit
    description: The units for the quantity.
  - name: days_supply
    description: The number of days supply included.
  - name: practitioner_id
    description: >
      Unique identifier for the practitioner who ordered the medication.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: data_source
    description: Custom description of the source system e.g. Epic.
  - name: tuva_last_run
    description: >
      The last time the data was refreshed.  Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run`  environment.  Timezone is configurable via
      the `tuva_last_run` var.


