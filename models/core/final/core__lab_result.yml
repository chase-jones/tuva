version: 2
models:
- name: core__lab_result
  description: >
    The lab result table contains information about lab test results,  including the
    LOINC code and description, units, reference range, and  result.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
      {% else %}core{%- endif -%}
    alias: lab_result
    tags: core
    materialized: table
  columns:
  - name: lab_result_id
    description: Unique identifier for each lab result.
    tests:
    - unique:
        config:
          severity: warn
  - name: patient_id
    description: Unique identifier for each patient.
  - name: encounter_id
    description: >
      Unique identifier for each encounter.  Included in this table if the  lab test
      can be linked to an encounter.
  - name: accession_number
    description: The lab order number from the source system.
  - name: source_code_type
    description: The code type from the source system.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: source_code
    description: The code for the lab from the source system.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: source_description
    description: The description for the lab test from the source system.
  - name: source_component
    description: >
      The description for the component of the test from the source system.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: normalized_code_type
    description: The normalized code type.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
  - name: normalized_code
    description: The normalized code e.g. LOINC.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: normalized_description
    description: The normalized description for the code.
  - name: mapping_method
    description: mapping method used to populate the normalized codes and descriptions.  Can
      be manual (fields were populated in input layer), automatic (dictionary codes
      matching the source code were found and was automatically populated) or custom
      (populated by normalization engine)
  - name: normalized_component
    description: The normalized component.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: status
    description: The status of the lab test.
  - name: result
    description: The result of the lab test.
  - name: result_date
    description: Date of the test result.
  - name: collection_date
    description: Date the test was collected.
  - name: source_units
    description: Source units of the lab test.
  - name: normalized_units
    description: Normalized units of the lab test.
  - name: source_reference_range_low
    description: The low end of the reference range from the source system.
  - name: source_reference_range_high
    description: The high end of the reference range from the source system.
  - name: normalized_reference_range_low
    description: The normalized low end of the reference range.
  - name: normalized_reference_range_high
    description: The normalized high end of the reference range.
  - name: source_abnormal_flag
    description: Indicates whether the result is abnormal or normal.
  - name: normalized_abnormal_flag
    description: Normalized abnormal flag.
  - name: specimen
    description: The type of specimen e.g. blood, plasma, urine.
  - name: ordering_practitioner_id
    description: >
      Unique identifier for the practitioner who ordered the lab test.
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: data_source
    description: Custom description of the source system e.g. Epic.
  - name: tuva_last_run
    description: >
      The last time the data was refreshed.  Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run`  environment.  Timezone is configurable via
      the `tuva_last_run` var.    

