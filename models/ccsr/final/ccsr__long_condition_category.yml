version: 2
models:
- name: ccsr__long_condition_category
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_ccsr
      {% else %}ccsr{%- endif -%}
    alias: long_condition_category
    tags:
    - ccsr
    materialized: table
  description: >
    This model contains a mapping of individual condition ICD-10-CM diagnosis  codes
    to the CCSR's clinically meaningful diagnosis categories. Each row  represents
    a mapping of an ICD-10 code to a CCSR category. As each ICD-10  code may be mapped
    to up to 6 categories, it's expected that this table  will output as many or more
    rows than the TUVA condition model. The model  is equivalent to the CCSR's Output
    Option 1 - Vertical File Output.
  columns:
  - name: encounter_id
    description: Unique identifier for each the encounter.
  - name: claim_id
    description: Unique identifier for each claim.
  - name: patient_id
    description: Unique identifier for each patient.
  - name: normalized_code
    description: "The ICD-10-CM code for the diagnosis."
    meta:
      terminology: 
        https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_cm.csv
      terminology_note: "**Note: this terminology set is too large to be loaded as
        a seed and is instead loaded from public cloud storage for supported adapters."
  - name: code_description
    description: "The ICD-10-CM code description provided in the CCSR CSV seed file."
  - name: condition_rank
    description: The numerical ranking of a diagnosis code in a claim.
    data_type: integer
  - name: ccsr_parent_category
    description: >
      The parent category code for each CCSR category. In practice, this is  the three
      letter prefix to the category code.
  - name: body_system
    description: >
      The body system to which each parent category belongs. The 22 body  systems
      generally follow the structure of the ICD-10-CM diagnosis  chapters. Note that
      the procedure tables don't have this column, but  a conceptually related field
      in procedure models is `clinical_domain`.
  - name: parent_category_description
    description: A description of the parent category.
  - name: ccsr_category
    description: >
      A CCSR category for the ICD-10-CM code. One ICD-10-CM code may have  up 6 CCSR
      categories associated, ordinally ranked by the  ccsr_category_rank. Will be
      null if a record has a `code` that isn't  referenced in the CCSR seed file.
  - name: ccsr_category_description
    description: >
      The description of the CCSR category as provided in the CCSR seed file.
  - name: ccsr_category_rank
    description: >
      The ordinal rank of a given CCSR category mapped to an ICD-10-CM code.  The
      CCSR seed CSV has the order of categories assigned to each  ICD-10-CM code.
  - name: is_ip_default_category
    description: >
      For each ICD-10-CM code, this field will return true for the CCSR  category
      that is the default value for the code if the underlying  record is an inpatient
      encounter.
  - name: is_op_default_category
    description: >
      For each ICD-10-CM code, this field will return true for the CCSR  category
      that is the default value for the code if the underlying  record is an outpatient
      encounter.
  - name: dxccsr_version
    description: >
      The version number of the CCSR program from which the dbt model was  derived.
  - name: tuva_last_run
    description: >
      The time at with the model was materialized. Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run` environment.   Timezone is configurable via
      the `tuva_last_run` var.

