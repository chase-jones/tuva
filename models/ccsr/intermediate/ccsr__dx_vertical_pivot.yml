version: 2
models:
- name: ccsr__dx_vertical_pivot
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_ccsr
      {% else %}ccsr{%- endif -%}
    alias: dx_vertical_pivot
    tags:
    - ccsr
    materialized: table
  description: >
    This is an intermediate model that pivots the DXCCSR's wide-format mapping  CSV
    into a long format table. While the seed uses 6 columns to represent  the 6 CCSR
    codes that may be present, this generates one row for each CCSR  category per
    ICD code, so up to 6 rows per code. 

    This model includes details and descriptions of the CCSR parent category  and
    body systems that are inherited by the final models.

    This model may also be useful in looking up CCSR condition category,  body system,
    and parent category information.
  columns:
  - name: test
    description: test  - name: code
    description: The ICD-10-CM code
  - name: code_description
    description: >
      The description of the ICD-10-CM code included in the seed file.
  - name: ccsr_parent_category
    description: >
      The CCSR parent category - the three letter prefix for each  alphanumeric category.
  - name: ccsr_category
    description: >
      A CCSR category for the ICD-10-CM code. One ICD-10-CM code may have up
      6 CCSR categories associated, ordinally ranked by the  ccsr_category_rank. Will
      be null if a record has a `code` that isn't  referenced in the CCSR seed file.
  - name: ccsr_category_description
    description: The human readable description of the `ccsr_category`.
  - name: ccsr_category_rank
    description: >
      The ordinal rank of a given CCSR category mapped to an ICD-10-CM code.  The
      CCSR seed CSV has the order of categories assigned to each  ICD-10-CM code.
  - name: is_ip_default_category
    description: >
      For each ICD-10-CM code, this field will return true for the CCSR  category
      that is the default value for the code if the underlying  record is an inpatient
      encounter.
  - name: is_op_default_category
    description: >
      For each ICD-10-CM code, this field will return true for the CCSR  category
      that is the default value for the code if the underlying  record is an outpatient
      encounter.
  - name: tuva_last_run
    description: >
      The time at with the model was materialized. Generated by  `dbt_utils.pretty_time`
      as the local time of the `dbt run` environment.   Timezone is configurable via
      the `tuva_last_run` var.

